name: CI - self-hosted test

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: [ self-hosted, ppc64le ]
    steps:
      - uses: actions/checkout@v4
      - name: Prepare build tools
        run: |
          echo "Preparing build tools (may require sudo/apt)"
          sudo apt-get update -y || true
          sudo apt-get install -y build-essential || true
      - name: Clean and build C sample (force rebuild)
        run: |
          echo "Cleaning any pre-existing binaries"
          rm -f hello || true
          make clean || true
          echo "Forcing rebuild"
          make -B || gcc -O2 -Wall -o hello hello.c
      - name: Build diagnostics
        run: |
          echo "Runner uname:"; uname -a
          echo "GCC version:"; gcc --version || true
          echo "Built file type:"; file ./hello || true
      - name: Run C sample
        run: |
          echo "Running the compiled binary"
          ./hello || true
      - name: Show runner info
        run: |
          echo "Running on $(uname -m)"
          uname -a
          lscpu || true
          echo "Finished self-hosted ppc64le test"
